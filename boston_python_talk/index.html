<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Open source electrophysiology in Python</title><meta charset="UTF-8"></meta><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><meta name="author" content="Narendra Mukherjee"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="tutorial.css" media="screen,projection"></link><script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: false,
        messageStyle: "none",
        TeX : { extensions : ['color.js'] }
      });
    </script></head><body class="impress-not-supported"><div id="impress"><div class="step step-level-1" step="0" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="0" data-y="0" data-z="0"><h1 id="systems-neuroscience-with-python-peering-into-the-black-box">Systems neuroscience with Python: peering into the <strong>"black box"</strong></h1><h2 id="narendra-mukherjee">Narendra Mukherjee</h2><h3 id="brandeis-university">Brandeis University</h3></div><div class="step step-level-1" step="1" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="1600" data-y="0" data-z="0"><h1 id="about-me">About me</h1><ul><li>5th year PhD student in Neuroscience at Brandeis University</li><li>Work with Prof. Donald Katz</li><li>Study the processing of tastes in the rat brain</li><li>Love Python (and R) and open source (and the bike!)</li><li>More at: narendramukherjee.github.io</li></ul></div><div class="step step-level-1" step="2" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="3200" data-y="0" data-z="0"><h1 id="systems-neuroscience">Systems neuroscience</h1><p>Study of neural circuits and the brain '<em>systems</em>' they form in the context of animal behavior.</p><img src="systems_neuroscience.png" width="375px" height="325px"></img><p>In-vivo electrophysiology (<strong>Ephys</strong>) is a crucial technique: recording the activity of neurons in awake, behaving animals.</p></div><div class="step step-level-1" step="3" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="4800" data-y="0" data-z="0"><h1 id="the-black-box-of-ephys">The black box of Ephys</h1><img src="experiment_black_box.png" width="900px" height="500px"></img></div><div class="step step-level-1" step="4" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="6400" data-y="0" data-z="0"><h1 id="peeking-into-the-black-box">Peeking into the black box</h1><img src="experiment.png" width="900px" height="500px"></img></div><div class="step step-level-1" step="5" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="8000" data-y="0" data-z="0"><h1 id="big-data-challenge">Big data challenge!</h1><ul><li>Voltage recordings from 64 electrodes at 30 kS/s (stored as 16 bit integers).</li><li>(<strong>30000</strong> samples) x (<strong>64</strong> electrodes) x (<strong>2</strong> bytes) ~ <strong>3.8MB/s</strong>. About <strong>26GB</strong> for a <strong>2 hour</strong> recording.</li><li>Electrode numbers/recording durations can potentially increase in the future.</li></ul></div><div class="step step-level-1" step="6" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="9600" data-y="0" data-z="0"><h1 id="superpowers-needed">Superpowers needed!</h1><ul><li>Data format that can<blockquote><ul><li>Allow fast access to small chunks of data and support larger-than-memory workloads.</li><li>Structure data/metadata at different levels.</li></ul></blockquote></li><li>Parallelization tool to break up the processing of each electrode's data into a separate process.</li><li>GUI for users to provide inputs during spike sorting.</li><li>Scientific computing stack for digital signal processing and unsupervised clustering.</li><li>Diverse (and fast!) plotting framework.</li></ul></div><div class="step step-level-1" step="7" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="11200" data-y="0" data-z="0"><img src="python-superman.jpg" width="900px" height="500px"></img></div><div class="step step-level-1" step="8" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="12800" data-y="0" data-z="0"><h1 id="hierarchical-data-format-hdf5">Hierarchical Data Format (HDF5)</h1><ul><li>Numerical big data.</li><li>Data arranged in a hierarchy of <em>nodes</em>.</li><li>Filesystem inside a file.</li><li>Fast access to data with minimal I/O overhead.</li></ul></div><div class="step step-level-1" step="9" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="14400" data-y="0" data-z="0"><img src="logo-pytables-small.png"></img><h1 id="creating-a-hdf5-file">Creating a HDF5 file</h1><pre class="highlight code python"><span class="kn">import</span> <span class="nn">tables</span>

<span class="c1"># Create hdf5 file</span>
<span class="n">hf5</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">open_file</span><span class="p">(</span><span class="n">hdf5_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s1">'.h5'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span>
          <span class="n">title</span> <span class="o">=</span> <span class="n">hdf5_name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Node for raw electrode data</span>
<span class="n">hf5</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">'raw'</span><span class="p">)</span>

<span class="c1"># Node for digital inputs</span>
<span class="n">hf5</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">'digital_in'</span><span class="p">)</span>

<span class="c1"># Node for digital outputs</span>
<span class="n">hf5</span><span class="o">.</span><span class="n">create_group</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="s1">'digital_out'</span><span class="p">)</span>
<span class="n">hf5</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Create an array with data</span>
<span class="n">hf5</span><span class="o">.</span><span class="n">create_array</span><span class="p">(</span><span class="s1">'/raw'</span><span class="p">,</span> <span class="s1">'electrode1'</span><span class="p">,</span> <span class="n">electrode1_data</span><span class="p">)</span></pre></div><div class="step step-level-1" step="10" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="16000" data-y="0" data-z="0"><h1 id="pytables-loves-numpy">Pytables loves Numpy</h1><p>The data is extracted as numpy arrays following the hierarchy of the nodes in the HDF5 file</p><pre class="highlight code python"><span class="c1"># Extract the spike waveforms of neuron 1</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">hf5</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">sorted_units</span><span class="o">.</span><span class="n">unit001</span><span class="o">.</span><span class="n">waveforms</span><span class="p">[:]</span></pre><img src="hdf_nodes.png" width="450px" height="500px"></img></div><div class="step step-level-1" step="11" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="17600" data-y="0" data-z="0"><h1 id="meta-data-resides-in-the-same-file">Meta-data resides in the same file</h1><pre class="highlight code python"><span class="c1"># Define a UnitDescriptor class to be used</span>
<span class="c1"># to add things (anything!) about the sorted</span>
<span class="c1"># units to a pytables table</span>
<span class="k">class</span> <span class="nc">UnitDescriptor</span><span class="p">(</span><span class="n">tables</span><span class="o">.</span><span class="n">IsDescription</span><span class="p">):</span>

    <span class="n">electrode_number</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Int32Col</span><span class="p">()</span>

    <span class="c1"># Is this a single neuron?</span>
    <span class="n">single_unit</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Int32Col</span><span class="p">()</span>

    <span class="c1"># 2 types of single neurons</span>
    <span class="n">regular_spiking</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Int32Col</span><span class="p">()</span>
    <span class="n">fast_spiking</span> <span class="o">=</span> <span class="n">tables</span><span class="o">.</span><span class="n">Int32Col</span><span class="p">()</span></pre></div><div class="step step-level-1" step="12" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="19200" data-y="0" data-z="0"><h1 id="more-utilities-with-pytables">More utilities with Pytables</h1><ul><li>Compression tool: ptrepack</li><li>Viewer tool: vitables</li></ul><img src="vitables.png" width="800px" height="500px"></img></div><div class="step step-level-1" step="13" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="20800" data-y="0" data-z="0"><h1 id="gnu-parallel-for-parallelizing-processing">GNU Parallel for parallelizing processing</h1><img src="gnu_parallel.png"></img><ul><li>Great parallelization tool for .nix systems.</li><li>Allows processes to be released dependent on CPU workload, available RAM, etc.</li><li>Can resume failed processes from a log file.</li><li>Very similar feel to HPC task managers (like qsub).</li></ul></div><div class="step step-level-1" step="14" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="22400" data-y="0" data-z="0"><h1 id="gui-for-user-inputs-easygui">GUI for user inputs: easygui</h1><pre class="highlight code python"><span class="kn">import</span> <span class="nn">easygui</span>

<span class="c1"># Get name of directory with the data files</span>
<span class="n">dir_name</span> <span class="o">=</span> <span class="n">easygui</span><span class="o">.</span><span class="n">diropenbox</span><span class="p">()</span>

<span class="c1"># Get the type of data files (.rhd or .dat)</span>
<span class="n">file_type</span> <span class="o">=</span> <span class="n">easygui</span><span class="o">.</span><span class="n">multchoicebox</span><span class="p">(</span><span class="n">msg</span> <span class="o">=</span> <span class="s1">'File type'</span><span class="p">,</span>
                                  <span class="n">choices</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'.dat'</span><span class="p">,</span> <span class="s1">'.rhd'</span><span class="p">))</span></pre><img src="easygui.png"></img></div><div class="step step-level-1" step="15" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="24000" data-y="0" data-z="0"><h1 id="data-analysis-stack">Data analysis stack</h1><img src="scipy.png"></img><ul><li>Scipy for digital signal processing.</li><li>Numpy for data manipulation.</li><li>Scikit-learn for unsupervised clustering.</li></ul></div><div class="step step-level-1" step="16" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="25600" data-y="0" data-z="0"><h1 id="spike-sorting-transparent-box">Spike sorting "<strong>transparent box</strong>"</h1><img src="processing_pipeline.png" width="1000px" height="600px"></img></div><div class="step step-level-1" step="17" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="27200" data-y="0" data-z="0"><h1 id="results-spikes-from-single-neurons">Results: spikes from single neurons</h1><img src="combined_units.png"></img></div><div class="step step-level-1" step="18" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="28800" data-y="0" data-z="0"><h1 id="more-details">More details</h1><p><a href="http://conference.scipy.org/proceedings/scipy2017/narendra_mukherjee.html">Paper</a> in Proceedings of Scipy 2017</p><p><a href="https://sites.google.com/a/brandeis.edu/katzlab/technology">Katz</a> lab website</p><p>Github: narendramukherjee/blech_clust</p><p>Email: narendra(at)brandeis(dot)edu</p></div><div class="step step-level-1" step="19" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="30400" data-y="0" data-z="0"><h1 id="all-thanks-to">All thanks to...</h1><img src="katz_lab.jpg" width="800px" height="600px"></img></div><div class="step step-level-1" step="20" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="32000" data-y="0" data-z="0"><img src="funding.png"></img></div><div class="step step-level-1" step="21" data-rotate-x="0" data-rotate-y="0" data-rotate-z="0" data-scale="1" data-x="33600" data-y="0" data-z="0"><img src="python_logo.png"></img></div></div><div id="hovercraft-help"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>